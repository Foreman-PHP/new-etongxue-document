# 业务逻辑的实现

## 实现建议

为了规范化业务逻辑代码的编写和维护工作, 本模块, 以及未来其他模块的开发, 均可以按照本节所描述的流程, 来进行开发.

- 数据流
  - 前端提交的数据进入 Yaf 框架
  - 创建路由, 由 Yaf 框架负责转发的控制器类
  - 通过工厂模式, 生成自定义的 Request对象
  - 通过多个 DAO 层的工具类, 完成具体的业务逻辑
    - 对于简单的业务逻辑, 也可以直接调用 Model 来完成, 不一定非要实现一个 DAO
    - 由于本模块功能不复杂, 目前将业务逻辑与 DAO 实际写在一起, 如果逻辑复杂, 则需要单独对该逻辑抽离出业务逻辑层
  - 通过工厂模式, 生成自定义的 Response 接口对象
  - 打印 Response 接口的 toJson() 方法向前端返回结果

- 重要的框架文档节点
  - conf/application.ini 配置文件
  - Bootstrap.php 框架启动引擎, 路由, 配置加载, 中间件注册等核心功能都在这里
  - controllers 目录, 里面全部是控制器, 但每个都很简单, 功能也很明确
    - constrollers/Error.php 文件: 运行过程中的异常处理
  - models: 数据模型层, 采用了 Laravel/database 库, 可以快速开发出原型, 满足业务需求. 未来应迁移到 PDO
  - services: DAO都在这里, 主要是实现业务逻辑
  - tests: 测试用例



## 人脸服务
- 帕菲特 不去实现华三的基础数据接口 只其中的实现人脸识别接口
  
    #### 请求参数
    | 参数名         | 是否必须        | 参数类型   | 说明                                      
    | ------------- | :-------------: | -----:   | -----:                                   
    | student_id    | Yes             | String   | 学生UID                    
    | file          | Yes             | file     | 人脸照片文件
    | category      | Yes             | string   | 类型, 固定为face

#### 参数说明
- 在原来华三的接口文档中需要学生的UID参数 (这个参数是基础数据接口中添加学生接口返回的)
- 现在改成 这个参数由 帕菲特 这边来生成用来代替华三生成的UID 华三只需要存帕菲特这边的UID

## 考勤数据
- 该接口是帕菲特编写,华三请求, 人脸识别到请求该接口

| 参数名         | 是否必须         | 参数类型 | 说明
| ------------- | :-------------: | -----: | -----:
| code          | Yes             | String | 云班牌设备码
| student_id    | Yes             | String | 学生UID
| verify_time   | Yes             | String | 识别的时间(时间戳)


